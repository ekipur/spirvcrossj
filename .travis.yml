language: java
env:
  global:
  - secure: bXmcp9PKyOQZFmc0vWgaPytk84R4wEEeiBltwiV0P2eh1qZ2PFpmuMqAXrgG+748ctbNImQWo4bxRuc8UWgQhoPZfKtUgmhjGN3xqXfrtLTd8PN/mOG90nlSwapwywBoZD1lk0vq4HDNem+Jc/Fht+iDYOdUlSZLnRz6Z7u6tmJSndmr5EKTGExNLH1dug7JBkLHxKv4SL5FzolgAPhWoMlMir/EwayAD0fTe+g85gKbADVm6sA73VX032rxTORXImbYot5OnwDB1lGGCwn5qqKtoyRihiCUpnkNKv+IwrTDoUYWSSQiAt8Xa8H6sG3/NzO5yxXUD3UJwQUpP5QQAoExUGY8svEF0vP95L/I1vh/KJbaw0rHkd2ecyLI+79bJj91Ebk3i0pLvOrulA+hmDX52lM+VdInCRCLbYQeji7N0HZ6mm2dk7CrBTBHf1Oej4dxDfglElCcoSubIM+CZ5fKEAnb7I4CfslThdtKSn+sVa2XRfNuDQMeupM+eLFZT+nSynrHfgKdH29OFVHbwrMTvds/qhvPsHQ6fM5MaaDiF+XbpU97Tmte1cv9ga204W9eg7lHO2DYYgxnmKV+DLaMWHvvadRPDiaQnWsno2PFhaDt3+xblhdf0QwX8Oxl3uUTxiy1YvXGuVP2sKyT87pJeVewiYEDsnDqns1LX1E=
  - secure: c5WsbBE7Xp8cnuoC0cHy5NavZ4556z9fjLlADXj6kT7XppQjdZ/+q5CvgETYCltAphlhI8vG0yRyS7QuGF+VUADl5BVE75rMFFmCjY30f5u6nQqhQUcfx/L/bQRZbjmCQdcPooYvk2AmMln4yg5sTxs/ZnbhfPB0v7j2+wgtSYvXErj6yLVrl5I3R1QvGj2Nfs9xSbQ1beJd+BNtaBRAy9OU0Uzq63HtjrAe2muRSwQy+wFAJTGnJqPN+1eqj0w8nyht+osJgx04G0xvhJoff4/kOu2gWEioFT/tfuCIFVhcra9VO4y1qwob3xqdzOozoZO5cmjqUOpCIZWn0XrqFhZc4kv9AXwNH+M/bgEBfFvF1WrzbiFKxAgifRRFkNm/ZCIyGzMhAqDiARBKuleCI42VD+2LJ1nFJ6wZ1GZP3hL0mzfXQM5YFrZgrchuO2b1HM8YyxrGLpDA+zD3cF4iVuOgHWRl73wdroR+yTF9Js7JcEF6gHz5yqr/brbzcTGRzYInQwg4jwhVhWm5EWH7ir3IINBiBQLvfP0uS2GwqHLOadw9jn7kPoBDdncF8Nv/Xln2pCR6GNWN+6lWTj0QsukjQJ792RMA1Zxtw8ES39KBEBLbEQSxJdahgpW98noWpq3JYQxMpnetrA5DjV9yld55iCxa29aIKJv5xyafm/U=
  - secure: kkBE4LzLQELWHDxuDFgHf7sF93EDKu5veo+JCQgNoHveTewenC/f5QNmuxJgQMV6MsG3e/6VZGTPGaZKcFAh8meoXNz8uWkYmklmjhM3tqT/HZIa8H1WiRFGG2Vd7nD91A51RNcWIS2PGl2K5y/Nv/1sf4Z60vWjZziiM0B8+mlFEvCXuTZ4eDr9rXgHufoPnub8Y2nwB/gDZA8DqpJcO/U4nEqiBUiOe+nHWr1HhmCf0P3j1y2G40zeKjafdNHn/KfYjMwmy8ye8K0oxgUiwrIfk2fBRrca/MN9T17mF2+64KR1u/DEJjTtZri3+yit4WzG7cHhZbM5y5ekDtKsqYBXSElay+BmKBU7d/S7hRRJey0Bc1hkkew8d0CE6XPDmiBj+xGj89DcxQwUrOY/+5bVvEMzT4fhYUErsb6w7H6A9wl1+gfzUfLE71MOrVrCocomGuTpH0/DQ3umiWvsyLN0Bu+xWRXVv7qZbQL/MS0dij/cYqXg/LCfmeyMaE/nEreQKjFnAiB7G0QmoA063OVZaZWCbYacED0zM89H8Mrc3mtHwPA+bDOdOEygxV1fEyQSY6LLAvRDZaIsSNOnREU0/sdKeFpzMVwzpL7/9JKTSfpe3XjB7Bt+f9kB32WhFXI0Mhhgyf1oRg9X21e5oI1WkXDUavlcCzBtmzSZa1s=
  - secure: V3z1Yc88NoazfydGuxFNmHwBRYtd7jGum4riUlguVGPDku++UOixkGSF1rg022MpGRef5ubsEzRPe5+nvRzqI6AyVnH3nHEw8jMj+PWINq97pAsQxgiNGYOGZHut0idkwX2OlVVj4dRhFwGvurQeemPTtf/a254h/w53nVx5P87CtqvqrTxUXCMOxrdOrPdFl/OMaPcg66Vzj8n9ax0jUhGbpnxzhgdehBqqOqpmgN20nBFt7sr7eUnbWBq6w93SMCZ9Y0xcSptZx1bYP1SRMgDJEJIoAweA7Pp7GJ5wNbpDXrDDRucfKhhLCiL7ZmZJ3EhMK2gIkz4MLvm1najeZwPgUUlBTb59ACflAOdVFL/0UWNVC9sl+L7EUkNCBWkhh5roKT8GU51C5EknA003Qv9jdbDtwBFNwFXGFy3EMvdga6Zjl8msn2ApEpCtIoCF/+iFw/ssdPdBTDGRn2Q1fUYK0vFHKqRryBY2BYXpi9OtYjAWCHyxChc0CGZt8bjBouqOis9KhM1wzqZtfgPqtMBZQ3JL6jO8mDs4+41qoeowdF2kMWrAVMWuRxyDvl/goPKKrT71BY9WscFRw76AU2AG0E4HMOZe7937tte4zTOgpsSIFaGiezIsrx0k8CwNvLC4QEG3bQQ/Tex4+KcLoXmiKSttCDAu6FHpkWz080M=
  - secure: "j7ll0PBrvPFQWcKxJXtA/0pF5U1Hj4AG66in1dKq8AWjtv1EKgi0kSZHr7cKgNaPwc5wjHkd3lDsR2UnKHmBGY3xfPXaINhB5mEtZe+FuKYRqBn4hqr+eTY+Dhlkwv756YZU2EHnGBVq/ibjg03G+pE3U9A2AI5vZOdaiSBp7Gw3fv8Drgyn409RioUGyUPFDgUPnFe1Ltt62NurAnnIO95ntI67mfmUd+5lIgASZwi9xC+da3ZjUuLzWzdHKZ48+6fko01BxJIhX5zcDjT74ankqKw0G3enaNwUz77pKHXSF72Ou07SaF8fGPxwHkzhoYYzd0BOX6Hh3XHFehRs9gIrJdQnzh8Tng6RycsbibTsp8AS38+SAb8pfxYwMuU/YTZMxLhEPSg0EUPE9+2xph4bmbniPCzLgAPjNRKtxYVt6rVsAtq5q+4i/4+nSGV5yK/pzLuBcjbqNu0k6qP+HmCRoYvPvcN8rtGjJflWcZpTU7jYyhL4YuMpqKH+QS1npzpAuG69yX4YzJsFGunYC3wp6aZn4G8hIAyB55zd7bKE00EfwFFr6CgDm6aHrxa8SVSyycKOzrzS/5cuFKTlCWDVfGor4M8Dk6te9lEju75ppjUlvKjrj2fVSwJr3z+IHunevdIaCVIwLd2B6Sa/7pC9aw9JHKvwodIjzdnuVLI="
  - secure: "K89IeX/cbq8sacV7ql8IZ0h8nhT3ZENeVWchboxdDiz/tV9qnqnFYsT+k8C6wmZvI67qb1L7hSizdZzBpVqBmmILRTvH1vMFyvzVGH04eYeKnzxscOQJjLhDN2M5WBXtTyiBUPRQ0nVMhJlOCfFXy/N3wy7VWvnFDsdJUjaJDd2YrmupTjN9eL8mW8nHajf5fpypfYwDA2B0WFCViCLHgG8HS8YjPMJNqrrzJ3+sw9WLM94wdzj26vCJj4vsIb122PNSZaRGqYuSlI8wsbdE0FFg/ltUbisFJJo0X4ia4rl1P0JmcdJxNRRg21FA8TS+VqZivOXHANpZKIZMGWQZie/tEk26BXo2x1zF/Q3uiRbwR8OzOeHOEpJr9sMVyN0lyu9j3JUGY2QH8NhpxiVrOBNElrIauIZrYTZ1bzuCKGC7g2dtX9IOQWVB0VizOKqlAZgJGGDblP110dUsNQJ1UYIlssLq7J8qMsza1/fH6v5a/OXCctBNRquc1Hh2XL50XR1YACtw5aXrViLCLPuVpZewSjY3Sr2RMWsuG7d6B1OtCWu9anZwC4MTfVJhoXCW+1c+1vVMzsK6EtuReiRfmU995RcDrLeYIkwyU567SlRaLDu6yooVe5Bfl6OXPtA4joR+fQl/vnau+ASznQBUTUVAjgb+JOD0dzHQYF041fs="
matrix:
  include:
  - os: linux
    jdk: openjdk8
    sudo: false
    addons:
      apt:
        packages:
        - cmake
        - cmake-data
        - clang-3.8
        - gnupg2
        - openjdk-8-jdk-headless
  - os: osx
    osx_image: xcode11.3
addons:
  homebrew:
    taps: AdoptOpenJDK/openjdk
    casks: adoptopenjdk8
    packages:
    - adoptopenjdk8
    - swig
    update: false
cache:
  directories:
  - $HOME/.m2
before_install:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then wget http://prdownloads.sourceforge.net/swig/swig-4.0.0.tar.gz
  && tar xfz swig-4.0.0.tar.gz && cd swig-4.0.0/ && ./configure && make && sudo make
  install && cd ..; fi
install:
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then /usr/libexec/java_home -V; fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then export JAVA_HOME=$(/usr/libexec/java_home-v1.8); fi
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then echo "UPDATESTARTUPTTY" | gpg-connect-agent > /dev/null 2>&1; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then export COMPILER=clang++-3.8; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then export CXX=clang++-3.8; fi
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then export CC=clang-3.8; fi
- git submodule init
- git submodule update
script:
- export CMAKE_BUILD_PARALLEL_LEVEL=4
- cd glslang
- git apply ../fix-tokenizer.patch
- python ./update_glslang_sources.py
- cd ..
- cd SPIRV-cross
- git apply ../fix-small-vector.patch
- cd ..
- mkdir -p target/build
- cd target/build
- cmake ../..
- cmake --build . -- -j4
- cd ../..
- ./post-build.sh
- mvn -B package
after_success:
- if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then echo "allow-loopback-pinentry" >> ~/.gnupg/gpg-agent.conf; fi
- killall -9 gpg-agent
- export GPG_TTY=`tty`
- gpg-agent
- export PINENTRY_MODE="--pinentry-mode=loopback"
- if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then ln -s `which gpg` /usr/local/bin/gpg2; fi
- unzip -l target/spirvcrossj-*-natives-*.jar
- deploy/before-deploy.sh
- deploy/deploy.sh
